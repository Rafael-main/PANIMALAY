<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
 	<link rel="shortcut icon" type="text/css" href="{{url_for('static',filename='images/house.png')}}">
  	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   	integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   	crossorigin=""/>
   	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   	integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   	crossorigin="">
   	</script>
   	<link rel="shortcut icon" type="text/css" href="{{url_for('static',filename='images/house.png')}}">

  	<style>
	#unitsContainer{
	float: left;
	width: 40%;
	padding: 10px;
	height: 500px;
	overflow-y: scroll;
	border-radius: 10px;
	}

	#mapContainer{
	float: left;
	width: 60%;
	padding: 10px;
	height: 500px;
	border-radius: 10px;
	}
	
	#resultContainer{
	margin-top: 30px;
	}

	.card{
	margin-bottom: 20px;
	}

	ul li{
	display: inline-block;
	}
	#searchBarContainer{
	border-radius: 50px;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
    margin-left: 180px;
    border: 1px solid black;
    width: 300px;
	}
	h4{
	margin-left: 20px; 
	margin-right: 50px;
	}
	#SearchBarSpan{
	cursor: pointer;
	}

	input[type=range] {
	-webkit-appearance: none;
	margin: 20px 0;
	width: 100%;
	}
	input[type=range]:focus {
	outline: none;
	}
	input[type=range]::-webkit-slider-runnable-track {
	width: 100%;
	height: 4px;
	cursor: pointer;
	animate: 0.2s;
	background: #03a9f4;
	border-radius: 25px;
	}
	input[type=range]::-webkit-slider-thumb {
	height: 20px;
	width: 20px;
	border-radius: 50%;
	background: #fff;
	box-shadow: 0 0 4px 0 rgba(0,0,0, 1);
	cursor: pointer;
	-webkit-appearance: none;
	margin-top: -8px;
	}
	input[type=range]:focus::-webkit-slider-runnable-track {
	  background: #03a9f4;
	}
	.range-wrap{
	width: 500px;
	position: relative;
	}
	.range-value{
	position: absolute;
	top: -50%;
	}
	.range-value span{
	width: 30px;
	height: 24px;
	line-height: 24px;
	text-align: center;
	background: #03a9f4;
	color: #fff;
	font-size: 12px;
	display: block;
	position: absolute;
	left: 50%;
	transform: translate(-50%, 0);
	border-radius: 6px;
	}
	.range-value span:before{
	content: "";
	position: absolute;
	width: 0;
	height: 0;
	border-top: 10px solid #03a9f4;
	border-left: 5px solid transparent;
	border-right: 5px solid transparent;
	top: 100%;
	left: 50%;
	margin-left: -5px;
	margin-top: -1px;
	}
  	</style>
</head>
<body>
  <header>
     <nav class="navbar" style="height: 50px;">
     	<ul>
     	<li>
          <a class="navbar-brand" href="/" style="color: black;font-size:20; font-family: 'baybayin rounded';"><strong><h2>P A N I M A L A Y</h2></strong></a>
        </li>
        <li>
        	<span id="SearchBarSpan" data-toggle="modal" data-target="#searchModal">
				<div id="searchBarContainer">
					<ul>
					<li>
						<h4>Wander now!</h4>
					</li>
					<li>
						<i class="fas fa-search"></i>
					</li>
					</ul>
				</div>
			</span>
        </li>
        {% if username is not defined or username=="unknown"%}
        <li class="nav-item" style="margin-left: 200px;">
        	<a href="http://127.0.0.1:5000/signup" style="color: black;font-size:18;font-family: monserrat"><strong>SIGNUP</strong></a>
        </li>
        <li style="margin-left: 20px;" class="nav-item">
        	<a href="http://127.0.0.1:5000/signin" style="color: black;font-size:18;font-family: monserrat"><strong>LOGIN</strong></a>
         </li>
        {% elif username is defined and username!="unknown" %}
        <li class="nav-item dropdown" style="margin-left: 200px;">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color: black">
             {{username}}
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
             <a class="dropdown-item" href="http://127.0.0.1:5000/profile">Profile</a>
              <a class="dropdown-item" href="http://127.0.0.1:5000/renter/reservations">Reservations</a>
              <a class="dropdown-item" href="http://127.0.0.1:5000/reviewed/units">Reviewed Unit</a>
              <a class="dropdown-item" href="http://127.0.0.1:5000/rented/unit">Rented Unit</a>
              <a class="dropdown-item" href="http://127.0.0.1:5000/account">Manage Account</a>
            </div>
	      </li>
	      <li class="nav-item" style="margin-left: 20px;position: static;">
	        <a href="{{url_for('logout')}}" style="color: black;font-size:18;font-family: monserrat"><strong>LOGOUT</strong></a>
	      </li>
        {% endif %}
        </ul>
   	</nav> 
   </header>
<div id="searchModal" class="modal fade" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Search filter</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    <div class="modal-body">
      <form action="{{url_for('redirectSearch')}}" method="POST">
      	<div class="col-12 mt-2">
      		<label for="location"><strong>Location</strong></label>
      		<input class="form-control" type="text" name="location" id="location" required="1" placeholder="Where do you want to stay?">
      	</div>
      	<div class="col-12 mt-2">
      		<label for="unitType"><strong>Unit Type</strong></label>
      		<select class="form-control" id="unitType" name="unitType" required="1" >
	        	<option selected disabled>Select</option>
	        	<option value="Boarding House">Boarding House</option>
	        	<option value="Appartment">Appartment</option>
	        	<option value="Dorm">Dorm</option>
      		</select>
      	</div>
      	<div class="col-12 mt-2">
      		<label for="genderAccommodation"><strong>Gender Accommodation</strong></label>
      		<select class="form-control" id="genderAccommodation" name="genderAccommodation" required="1">
      			<option selected disabled>Select</option>
      			<option value="Male">Male</option>
			    <option value="Female">Female</option>
			    <option value="Unisex">Mix Gender</option>
			</select>
      	</div>
      	<div class="col-12 mt-2" style="margin-left: 50px;">
	         <ul>
	            <li>
	               <button id="plusCapacity" type="button" onclick="increment()" style="border: none;background-color: white;"><i class="fas fa-plus-circle fa-2x"></i></button>
	            </li>
	            <li>
	               <div class="col-12 mt-2">
	               	  <label for="capacityModalInput"><strong>No. of Renter</strong></label>
	                  <input type="number" class="form-control" name="capacityModalInput" id="capacityModalInput" min="1" max="10" value="1">
	               </div>
	            </li>
	            <li>
	               <button id="minusCapacity"  type="button"  onclick="decrement()" style="border: none;background-color: white;"><i i class="fas fa-minus-circle fa-2x"></i></button>
	            </li>
	         </ul>
      	</div>
      	<div class="col-12 mt-2">
  			<label>
  				<strong>Budget</strong>
  			</label>

  		</div>
  		<br>
      	<div class="col-12 mt-2">
	      	<div class="range-value" id="rangeV"></div>
	      	<input id="range" name="budget" type="range" min="0" max="10000" value="0" step="1">
      	</div>
      <hr>
      <div>
        <button type="submit" class="btn btn-primary float-left" style="margin-left: 50px;border-radius: 50px">Search</button>
        <button type="button" class="btn btn-secondary float-right" data-dismiss="modal" style="margin-right: 50px;border-radius: 50px">Close</button>
      </div>
      </form>
    </div>
      <br>
    </div>
  </div>
</div>

{% if (allUnits|length)!=0  %}
<div id="resultContainer" class="container-sm">
<div class="row">
  	<div id="unitsContainer" class="column" style="background-color:#aaa;">
	   <h2>Units</h2>
	   {% for unit in allUnits %}
	    <div class="card" style="width: 26rem;">
	    	<br>
	    	<div class="card-body">
				  {% set unitImages = [] %}
				  {% for image in imagesBlob %}
				  {% if image.0 == unit.0 %}
				  {% set appendImage =  unitImages.append(image) %}
				  {% endif %}
				  {% endfor %}
				  {% if (unitImages|length)!=0 %}
				<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
				  <ol class="carousel-indicators">
				  	 {% for i in unitImages %}
				    <li data-target="#carouselExampleIndicators" data-slide-to="{{loop.index - 1}}"{% if loop.index==1 %}class="active"{% endif %}></li>
				     {% endfor %}
				  </ol>
				  <div class="carousel-inner">
				  	{% for i in unitImages %}
				     <div class="carousel-item{% if loop.index==1 %} active{% endif %}">
				      <img class="d-block w-100" src="data:;base64,{{i.3}}" style="max-height:250px;" alt="{{i.2}}">
				    </div>
				     {% endfor %}
				  </div>
				  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
				    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
				    <span class="sr-only">Previous</span>
				  </a>
				  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
				    <span class="carousel-control-next-icon" aria-hidden="true"></span>
				    <span class="sr-only">Next</span>
				  </a>
				</div>
				{% else %}
				<img class="d-block w-100" src="{{url_for('static',filename='images/noimageavailable.jpg')}}" style="max-height:100%px;border-radius:20px;">
				{% endif %}
				{% for business in rentalBusinesses %}
				{% if business.2 == unit.1 %}
	    		<h5 class="card-title">{{business.1}}</h5>
	    		<p class="card-text">{{business.3}}</p>
	    		{% endif %}
	    		{% endfor %}
	    		

	    		<a href="http://127.0.0.1:5000/selected/unit/{{unit.1}}/{{unit.0}}" class="btn btn-primary" style="border-radius: 50px" target="_blank"><i class="fas fa-eye">View Info</i></a>

	    		<button id="{{unit.0}}" onClick="mark(this.id)" class="btn btn-info"  style="border-radius: 50px"><i class="fas fa-map-marker-alt">Locate</i></button>
	    		<button class="btn btn-success" style="border-radius: 50px" data-toggle="modal" data-target="#reservationModal{{unit.0}}">Book Now</button>

	    	</div>
	    </div>
<div id="reservationModal{{unit.0}}" class="modal fade" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Requesting for Reservation</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    <div class="modal-body">
      <form action="{{url_for('addReservation',unitID=unit.0)}}" method="POST">
       <div align="center">
       	<h5 style="color:gray">
       		{% for r in rentalBusinesses %}
       		{% if r.2 == unit.1 %}
       		{{r.1}}
       		{% endif %}
       		{%endfor%}
       	</h5>
       	<br>
       	<h6 style="color: gray">Booking Date:{{currentDate}}</h6>
       	<h6 style="color: gray">Unit Rate:P{{unit.3}}/month</h6>
       	 </div>
       	
        <button type="submit" class="btn btn-primary float-left" style="margin-left: 50px;border-radius: 50px">Reserve</button>
        <button type="button" class="btn btn-secondary float-right" data-dismiss="modal" style="margin-right: 50px;border-radius: 50px">Cancel</button>
      </form>
    </div>
      <br>
    </div>
  </div>
</div>
	    {% endfor %}
	</div>
  <div id="mapContainer" class="column"></div>
</div>
</div>
{% else %}
<div id="resultContainer" class="container-sm">
	<h1>No units available. Please search unit first...</h1>
</div>
{% endif %}

<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script>

	var locations = {{allUnitsJSON|safe}};
	var map = L.map('mapContainer').setView([10.566233,120.262634],5);
	mapLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';
	L.tileLayer(
    	'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
   		 attribution: '&copy; ' + mapLink + ' Contributors',
    	maxZoom: 18,
    	}).addTo(map);

	for (var i = 0; i < locations.length; i++) {
		marker = new L.marker([locations[i][7],locations[i][8]])
		.bindPopup(locations[i][13])
		.addTo(map);
	}
  

    function mark(clicked_id){
	      var id = clicked_id;
	      var locations = {{unitLocationsJSON|safe}};
	      for (let i=0;i<locations.length;i++){
	      	var location = locations[i];
	      	if (location[0]===id){
	      		var latitude = location[2];
	      		var longitude = location[3];
	      		map.flyTo([parseFloat(latitude),parseFloat(longitude)], 8);
	      	}

	      }
	  }
</script>
<script>
	function increment() {
    document.getElementById('capacityModalInput').stepUp();
   }
   function decrement() {
   	document.getElementById('capacityModalInput').stepDown();
   }
   function updateTextInput(val) {
   	document.getElementById('textInput').value=val; 
    }

   const
   	range = document.getElementById('range'),
   	rangeV = document.getElementById('rangeV'),
   	setValue = ()=>{
   		const
   		newValue = Number( (range.value - range.min) * 100 / (range.max - range.min) ),
   		newPosition = 10 - (newValue * 0.2);
   		rangeV.innerHTML = `<span>${range.value}</span>`;
   		rangeV.style.left = `calc(${newValue}% + (${newPosition}px))`;
   	};
   	document.addEventListener("DOMContentLoaded", setValue);
   	range.addEventListener('input', setValue)

</script>


<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
</body>
</html>